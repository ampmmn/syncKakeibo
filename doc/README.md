# SyncKakeibo

個人で運用しているChangeLogメモ上の買い物ログと
Android用家計簿アプリ「かけ～ぼ」の同期をとるためのスクリプト

## 背景

- 昔(スマホ登場以前)からChangeLogメモ上に家計簿をつけていた(買い物ログ)
- Androidスマホを使うようになり、買い物ログをスマホアプリ上で確認できるようにしたいと考えた
- AndroidとPC間でデータを同期できる家計簿アプリを探したところ、かけ～ぼがよさそうだったので選択
- 家計簿アプリのデータをPCと同期した上で、PC側にて家計簿アプリのデータとChangeLogメモの買い物ログとをマージするようにする
  - データをマージした後、家計簿アプリとChangeLogメモそれぞれにマージ後の内容を反映したい

## 仕組み

- 家計簿アプリのデータをDropBoxにエクスポートする
- PC側で専用のスクリプト(このリポジトリで管理)を実行し、下記を行う
  - 家計簿アプリのデータファイルを読み、家計簿データ①を生成
  - ChangeLogメモの買い物ログのデータを読み、家計簿データ②を生成
  - ①と②をマージする → ③
  - ③からマージ後の家計簿アプリデータファイルを生成する → ④
  - ③のデータをChangeLogメモに書き戻す(家計簿アプリ側の情報をChangeLogメモ側に反映する)
- 家計簿アプリ側で④をインポートする(ChangeLoeメモ側の情報を家計簿アプリ側に反映する)

![](img/overview.svg)

![](img/sequence.svg)

## 対応バージョン

下記バージョンのデータで確認

かけ～ぼ 1.68.0

## スクリプトが想定する家計簿アプリのデータ形式

以下、スクリプトで扱うデータについてのみ記載する。

いずれも、CSV形式で文字コードはUTF-8、改行コードはLF

### cashbook.csv

```
No,日付,収入,支出,費目名,収支区分,メモ,帳簿コード,支払コード,請求日&支払回数,請求No,送金元orチャージ
"9999999","99991231","0","0","件数=19941  count=19941","支出","メモ","0","0",,,
```

- 以前はこのファイルが家計簿データ本体だった気がするが、どこかの時点で扱いが変わった様子
- 現在はヘッダ行とデータ行1行の計2行のデータファイル
- トータル件数が記載されているので、ここを更新する
 - 件数は後述の`cashbook_all.csv`のデータ件数になる

### cashbook_all.csv

```
No,日付,収入,支出,費目名,収支区分,メモ,帳簿コード,支払コード,請求日&支払回数,請求No,送金元orチャージ
"1","20031003","0","19190","趣味・娯楽費","支出","演劇XXX","0","0",,,
"2","20040506","0","18900","その他","支出","YYY温泉","0","0",,,
"3","20040619","0","130250","その他","支出","エアコンZZ-32-ABC-X","0","0",,,
...
```

- 12列構成

- 1列目は1から始まる連番
- 2列目は日付(YYYYMMDD)
- 3列目は収入金額(収支区分が"収入"の場合)
  - 支出の場合は0になる
- 4列目は支出金額(収支区分が"支出"の場合)
  - 収入の場合は0になる
- 5列目は費目
  - ChangeLogメモ上の買い物ログとは費目名称が異なるので対応するものに置き換える(後述)
- 6列目の値が"支出""収入"をとる
  - 後述するChangeLogメモでは金額の正負により支出/収入を分けているのでここを合わせる必要あり
- 7列目は説明
- 8,9列目は"0"で固定(自分の使い方の場合)
- 10～12列目は空欄(自分は使ってない)

## ChangeLogメモ上の買い物ログの書式

- アイテムヘッダのカテゴリを`買い物ログ`とする
- アイテムヘッダのタイトルは空欄
- コンテンツ部分に1行に一つの支出データを記載する
  - 費目 説明 金額を記載する(金額が正の場合は支出、負の値の場合は収入)

```
	* 買い物ログ:
	交 駐車場代 800
	食 スーパーA 2432
```

## 費目の対応表

|費目(ChnageLogメモ側)|費目(家計簿アプリ側)|説明|
|--|--|--|
|食|食費|食費(スーパー、コンビニなど)|
|保|保険|生命/火災保健|
|貯|貯蓄|貯蓄性商品(確定年金/株/投資信託など)|
|本|書籍|書籍、雑誌など(漫画や小説は娯楽費扱い)|
|酒|酒代|酒類(ノンアルコール飲料は食費扱い)|
|外|外食|外食|
|住|住宅|家関連費用(家賃、住宅ローン返済、固定資産税)、収入のうち住宅ローン用返済口座に振り込まれるもの|
|活|生活費|家具家電/雑貨/衛生消耗品・理容・美容・化粧品|
|雑|嗜好品|嗜好品(おやつ、飲料など)|
|交|交通費|交通費(ガソリン代は車カテゴリ)・高速代、駐車場代はこちら|
|娯|趣味・娯楽費|遊び関連の費用、趣味・娯楽費、旅行、個人的な買い物、季節イベントもの(例:正月飾り)|
|服|衣服|衣類。かばんや靴などもここに分類する。ただし学校で使うもの(制服、内履き、水着など)は教育費に計上する。|
|通|通信費|通信費、電話、プロパイダ費用など|
|光|光熱費|光熱費|
|医|医療費|医療費・医薬品|
|育|教育費|教育費(月謝、文房具、学費など)|
|車|車維持費|車維持関連の出費(自動車保険・自動車税、修理費など)|
|際|交際費|交際費(冠婚葬祭・贈答品、飲み会)|
|他|その他|上記で分類できない出費、給与賞与|

## 改訂履歴

- 2023/07/28 新規作成

